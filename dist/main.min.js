"use strict";var c=require("path"),o=require("fs"),e=require("process"),s=require("glob"),l=e.cwd(),u=c.resolve(l,"src/pages"),p=u.length+1,r=require("simple-progress-webpack-plugin"),t=require("compression-webpack-plugin"),n=require("webpack-bundle-analyzer"),a=n.BundleAnalyzerPlugin,m=require("terser-webpack-plugin"),g=require("optimize-css-assets-webpack-plugin"),h=function(r){var e,n,i=s.sync(u+"/*/main.js"),t={},a=[];return r||(e=c.resolve(l,"config/local.json"),o.existsSync(e)&&(n=o.readFileSync(e),a=[].concat(JSON.parse(n.toString()).modules))),i.forEach(function(e){var n,i,s=c.dirname(e).substr(p);(r||a.includes(s))&&(n=c.resolve("".concat(u,"/").concat(s,"/env.json")),i={title:"首页",keywords:null,description:null},o.existsSync(n)&&(i=Object.assign({},i,JSON.parse(o.readFileSync(n).toString()))),r&&"examples"===s||(t[s]=Object.assign({},i,{entry:"src/pages/".concat(s,"/main.js"),template:"public/".concat("login"===s?"login":"index",".html"),filename:"".concat(s,r?"/index.html":".html"),chunks:["vendors","commons",s]})))}),t};module.exports=function(i,s){var n=h(i);return{publicPath:s.prefix(i),outputDir:"dist",assetsDir:"static",pages:n,indexPath:"index.html",productionSourceMap:!i,chainWebpack:function(e){s.alias(e),Object.keys(n).forEach(function(n){e.plugin("html-".concat(n)).tap(function(e){return e[0].cdn=s.static(s.prefix(i))(n),e})}),s.chainWebpack&&"function"==typeof s.chainWebpack&&s.chainWebpack(e)},configureWebpack:function(e){e.externals=s.externals,e.performance={hints:"warning",maxEntrypointSize:5e7,maxAssetSize:3e7,assetFilter:function(e){return e.endsWith(".js")}},i&&e.plugins.push(new t({filename:"[path].gz[query]",algorithm:"gzip",test:new RegExp("\\.("+["html","js","css"].join("|")+")$"),threshold:10240,minRatio:.6,deleteOriginalAssets:!1}),new a({openAnalyzer:!1,analyzerMode:"static"})),e.optimization={splitChunks:{chunks:"all",minSize:3e4,maxInitialRequests:1/0,minChunks:1,maxAsyncRequests:5,automaticNameDelimiter:".",name:!1,cacheGroups:{commons:{name:"commons",priority:1,chunks:"initial",minSize:0,minChunks:1},vendors:{name:"vendors",priority:2,test:/[\\/]node_modules[\\/]/,chunks:"initial",minSize:0,minChunks:1}}},minimizer:[new m({cache:!0,parallel:!0,sourceMap:!1,terserOptions:{compress:{drop_console:s.dropConsole,drop_debugger:s.dropDebugger}}}),new g({cssProcessorOptions:{safe:!0}})]},e.plugins.push(new r({format:"minimal"})),s.configureWebpack&&"function"==typeof s.configureWebpack&&s.configureWebpack(e)},devServer:s.devServer,parallel:1<require("os").cpus().length}};